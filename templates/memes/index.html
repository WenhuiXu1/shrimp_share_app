{% extends 'base.html' %}

{% block content %}
{% from models.memes import get_comments_by_id %}
<h1>Shrimps Share/Shout</h1>


{% if current_user %}
<h3>Welcome, {{ current_user['first_name']}}</h3>
<p>Like or comment your fav meme :3</p>
<p>or even better, upload your own!</p>


<section class="controls">
    <form action="/sessions/delete" method="POST">
        <button>Log out</button>
    </form>

    <a href="/memes/new">Add a meme from internet</a>
    <form action="/upload" method="POST" enctype="multipart/form-data">
        <label for="image">Upload an image:</label>
        <input type="file" name="image" id="image">
        <input type="submit" value="Upload">
    </form>

</section>

<!-- <section class="add-meme">
        <span><a href="/memes/new">Add a meme</a></span>
    </section> -->

<section class="memes">
    {% for meme in memes%}
    <section class="meme">
        <header>
            <h4>{{meme['name']}}</h4>
        </header>
        <section class="controls">
            <a href="/memes/{{meme['id']}}/edit">Edit</a>

            <form action="/memes/{{meme['id']}}/delete" method="POST">
                <button>Delete</button>
            </form>

            <form action="/memes/{{ meme['id']}}/likes" method="POST">
                <button>Like {{likes[meme['id']]}}</button>
            </form>

            <form action="/comments/{{ meme['id'] }}/new">
                <button>Add/View comments</button>
            </form>

            {% set comments_for_meme = get_comments_by_id(meme['id']) %}
            {% if comments_for_meme %}
            <ul class="comments">
                {% for comment in comments_for_meme %}
                <li>{{ comment['content'] }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </section>
        <img src="{{ meme['image_url']}}" alt="meme">

    </section>
    {% endfor%}
</section>
<p>-----------------</p>
<p>All Comments:</p>
{% for comment in comments %}
<p>{{ comment['content'] }}</p>
{% endfor %}
<p>-----------------</p>
<p>Individual comments:</p>
{% for comment in comment_by_id %}
<p>{{ comment['content'] }}</p>
{% endfor %}

{% else %}
<h4>Sign up, log in and get VIPed!</h4>
<span><a href="/users/new">Sign up</a></span>
<span><a href="/sessions/new">Log in</a></span>

{% endif %}

{% endblock %}